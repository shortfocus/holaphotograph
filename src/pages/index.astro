---
import Layout from "../layouts/Layout.astro";
---

<Layout>
  <!-- 2. íˆì–´ë¡œ ì„¹ì…˜ (ìºëŸ¬ì…€) - í”Œë¡œíŒ… ë°” ë†’ì´ ì œì™¸í•œ ë·°í¬íŠ¸ -->
  <section
    class="hero-section relative left-0 right-0 w-full min-w-full overflow-hidden bg-[#0F172A] pt-[4rem]"
  >
    <div
      class="hero-glow absolute inset-0 bg-[radial-gradient(ellipse_80%_50%_at_50%_-20%,rgba(225,29,72,0.1),transparent)] pointer-events-none"
      aria-hidden="true"
    >
    </div>
    <div
      class="hero-noise absolute inset-0 pointer-events-none"
      aria-hidden="true"
    >
    </div>

    <div
      id="hero-carousel"
      class="relative flex h-full flex-col overflow-hidden"
    >
      <div
        class="hero-carousel-track flex h-full flex-1 items-center transition-transform duration-500 ease-out"
        style="transform: translateX(0);"
      >
        <!-- Slide 1: Camera Review Archive -->
        <div
          class="hero-slide flex h-full min-h-0 min-w-full shrink-0 items-center justify-center overflow-y-auto overflow-x-hidden py-2 sm:py-4 lg:py-6"
        >
          <div
            class="relative mx-auto flex w-full max-w-7xl flex-col items-center justify-center gap-8 px-4 py-24 sm:px-6 lg:flex-row lg:gap-16 lg:px-8"
          >
            <div class="flex-1 text-center lg:text-left">
              <span
                class="hero-animate inline-block rounded-full border border-[#E11D48]/40 bg-[#E11D48]/10 px-4 py-1.5 text-xs font-medium uppercase tracking-wider text-red-300"
                style="animation-delay: 0ms; opacity: 0"
                >Camera Review Archive</span
              >
              <h1
                class="hero-animate mt-6 text-3xl font-bold leading-tight tracking-tight text-white sm:text-4xl md:text-5xl lg:text-6xl"
                style="animation-delay: 100ms; opacity: 0"
              >
                ì¹´ë©”ë¼ ì„ íƒë¶€í„° <span class="whitespace-nowrap"
                  >ì´¬ì˜ ë…¸í•˜ìš°ê¹Œì§€</span
                ><br />
                <span class="text-[#F43F5E] whitespace-nowrap"
                  >ì‹¤ì „ ê¸°ë°˜ ë¦¬ë·° í”Œë«í¼</span
                >
              </h1>
              <p
                class="hero-animate mx-auto mt-4 max-w-xl text-base leading-relaxed text-slate-400 sm:text-lg lg:mx-0 lg:text-xl"
                style="animation-delay: 200ms; opacity: 0"
              >
                <span class="whitespace-nowrap">ì¥ë¹„ ë¹„êµ</span> Â· <span
                  class="whitespace-nowrap">ì‹¤ì‚¬ìš© í…ŒìŠ¤íŠ¸</span
                > Â· <span class="whitespace-nowrap">êµ¬ë§¤ ê°€ì´ë“œ</span>
              </p>
              <div
                class="hero-animate mt-8 flex items-center justify-center gap-6 lg:justify-start"
                style="animation-delay: 300ms; opacity: 0"
              >
                <a
                  href="https://youtube.com/channel/UCsD5VP6TvRMt-sq0q25HlIA"
                  target="_blank"
                  rel="noopener noreferrer"
                  class="hero-channel-icon group"
                  aria-label="ìœ íŠœë¸Œ"
                >
                  <img
                    src="/icons/youtube.svg"
                    alt=""
                    class="h-9 w-9 sm:h-10 sm:w-10"
                    aria-hidden="true"
                  />
                </a>
                <a
                  href="https://blog.naver.com/holaphotograph"
                  target="_blank"
                  rel="noopener noreferrer"
                  class="hero-channel-icon group relative inline-flex"
                  aria-label="ë„¤ì´ë²„ ë¸”ë¡œê·¸"
                >
                  <img
                    src="/icons/naver-blog.svg"
                    alt=""
                    class="h-9 w-9 sm:h-10 sm:w-10 block transition-opacity duration-250 group-hover:opacity-0"
                    aria-hidden="true"
                  />
                  <img
                    src="/icons/naver-blog-hover.svg"
                    alt=""
                    class="absolute inset-0 m-auto h-9 w-9 sm:h-10 sm:w-10 opacity-0 transition-opacity duration-250 group-hover:opacity-100"
                    aria-hidden="true"
                  />
                </a>
                <a
                  href="https://www.instagram.com/snap.hola"
                  target="_blank"
                  rel="noopener noreferrer"
                  class="hero-channel-icon group"
                  aria-label="ì¸ìŠ¤íƒ€ê·¸ë¨"
                >
                  <img
                    src="/icons/instagram.svg"
                    alt=""
                    class="h-9 w-9 sm:h-10 sm:w-10"
                    aria-hidden="true"
                  />
                </a>
                <a
                  href="mailto:holaphotographer@gmail.com"
                  class="hero-channel-icon group"
                  aria-label="ë¬¸ì˜í•˜ê¸°"
                >
                  <img
                    src="/icons/contact.svg"
                    alt=""
                    class="h-9 w-9 sm:h-10 sm:w-10"
                    aria-hidden="true"
                  />
                </a>
              </div>
            </div>
            <div
              class="hero-animate flex-1 min-w-0"
              style="animation-delay: 150ms; opacity: 0"
            >
              <div
                class="overflow-hidden rounded-2xl shadow-2xl shadow-black/30 ring-1 ring-white/10"
              >
                <iframe
                  src="https://www.youtube.com/embed/jMMTLjQLTWg?rel=0&autoplay=1&mute=1"
                  title="ì˜¬ë¼í¬í†  ìœ íŠœë¸Œ ì˜ìƒ"
                  class="aspect-video w-full min-h-[200px] sm:min-h-[280px]"
                  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                  allowfullscreen></iframe>
              </div>
            </div>
          </div>
        </div>
        <!-- Slide 2: í”„ë¡œëª¨ì…˜ -->
        <div
          class="hero-slide flex h-full min-h-0 min-w-full shrink-0 items-center justify-center overflow-y-auto overflow-x-hidden py-2 sm:py-4 lg:py-6"
        >
          <div class="mx-auto max-w-2xl px-3 text-center sm:px-4">
            <span
              class="inline-block rounded-full border border-[#F43F5E]/40 bg-[#F43F5E]/10 px-3 py-1 text-xs font-medium text-red-300 backdrop-blur sm:px-4 sm:py-1.5 sm:text-sm"
              >í•œì • í”„ë¡œëª¨ì…˜</span
            >
            <h2
              class="mt-3 text-2xl font-bold tracking-tight text-white sm:mt-6 sm:text-3xl md:text-4xl lg:text-5xl xl:text-6xl"
            >
              <span class="text-[#F43F5E]">ì˜¬ë¼í¬í† </span> í”„ë¡œëª¨ì…˜
            </h2>
            <p
              class="mx-auto mt-2 max-w-lg text-sm leading-loose text-slate-400 sm:mt-4 sm:text-lg sm:leading-loose lg:text-xl lg:leading-loose"
            >
              ì¹´ë©”ë¼ ë¦¬ë·° Â· ì´¬ì˜ ê°€ì´ë“œ Â· ìœ„í´ë¦¬ í¬ì»¤ìŠ¤ê¹Œì§€<br />
              ì§€ê¸ˆ êµ¬ë…í•˜ê³  ë‹¤ì–‘í•œ ì½˜í…ì¸ ë¥¼ ë§Œë‚˜ë³´ì„¸ìš”
            </p>
            <a
              href="https://www.youtube.com/channel/UCsD5VP6TvRMt-sq0q25HlIA"
              target="_blank"
              rel="noopener noreferrer"
              class="hero-cta mt-4 inline-flex items-center gap-2 rounded-2xl bg-[#E11D48] px-6 py-3 text-base font-semibold text-white shadow-lg transition-transform duration-200 hover:scale-105 hover:bg-[#be123c] active:scale-100 sm:mt-6 sm:px-8 sm:py-3.5 sm:text-lg"
            >
              <svg class="h-5 w-5" viewBox="0 0 24 24" fill="currentColor"
                ><path
                  d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"
                ></path></svg
              >
              ìœ íŠœë¸Œì—ì„œ ë³´ê¸°
            </a>
          </div>
        </div>
        <!-- Slide 3: ê³ ê° ë¦¬ë·° -->
        <div
          class="hero-slide flex h-full min-h-0 min-w-full shrink-0 items-center justify-center overflow-y-auto overflow-x-hidden py-2 sm:py-4 lg:py-6"
        >
          <div class="mx-auto max-w-2xl px-3 text-center sm:px-4">
            <span
              class="inline-block rounded-full border border-[#F43F5E]/40 bg-[#F43F5E]/10 px-3 py-1 text-xs font-medium text-red-300 backdrop-blur sm:px-4 sm:py-1.5 sm:text-sm"
              >ì‹¤ì œ ì´ìš© í›„ê¸°</span
            >
            <h2
              class="mt-3 text-2xl font-bold tracking-tight text-white sm:mt-6 sm:text-3xl md:text-4xl lg:text-5xl xl:text-6xl"
            >
              <span class="text-[#F43F5E]">ê³ ê° ë¦¬ë·°</span> í™•ì¸í•˜ê¸°
            </h2>
            <p
              class="mx-auto mt-2 max-w-lg text-sm leading-loose text-slate-400 sm:mt-4 sm:text-lg sm:leading-loose lg:text-xl lg:leading-loose"
            >
              ì˜¬ë¼í¬í† ì™€ í•¨ê»˜í•œ ê³ ê°ë‹˜ë“¤ì˜ ì†”ì§í•œ í›„ê¸°ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”.<br />
              ì¹´ë©”ë¼ ë¦¬ë·° Â· ì´¬ì˜ ì„œë¹„ìŠ¤ ë§Œì¡±ë„
            </p>
            <a
              href="/reviews"
              class="hero-cta mt-4 inline-flex items-center gap-2 rounded-2xl border-2 border-[#E11D48] bg-transparent px-6 py-3 text-base font-semibold text-white shadow-md transition-transform duration-200 hover:scale-105 hover:bg-[#E11D48]/20 active:scale-100 sm:mt-6 sm:px-8 sm:py-3.5 sm:text-lg"
            >
              <svg
                class="h-5 w-5"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
                ><path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path><path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"
                ></path></svg
              >
              ë¦¬ë·° ë³´ëŸ¬ ê°€ê¸°
            </a>
          </div>
        </div>
      </div>

      <!-- ì¸ë””ì¼€ì´í„° -->
      <div
        class="absolute bottom-5 left-1/2 z-10 flex -translate-x-1/2 items-center gap-2.5 rounded-full border border-slate-600/40 bg-slate-800/80 px-4 py-2 shadow-lg backdrop-blur-sm"
      >
        <button
          type="button"
          data-hero-dot="0"
          class="hero-dot h-2.5 w-7 rounded-full bg-[#E11D48] shadow-sm transition-all"
          aria-label="ìŠ¬ë¼ì´ë“œ 1"
          aria-current="page"></button>
        <button
          type="button"
          data-hero-dot="1"
          class="hero-dot h-2.5 w-2.5 rounded-full bg-slate-500 transition-all hover:bg-slate-400"
          aria-label="ìŠ¬ë¼ì´ë“œ 2"></button>
        <button
          type="button"
          data-hero-dot="2"
          class="hero-dot h-2.5 w-2.5 rounded-full bg-slate-500 transition-all hover:bg-slate-400"
          aria-label="ìŠ¬ë¼ì´ë“œ 3"></button>
      </div>
    </div>
  </section>

  <!-- 3. ì‹¤ì „ ì˜ìƒ ë¦¬ë·° ì„¹ì…˜ -->
  <section
    id="youtube-long"
    class="section-spacing border-t border-slate-200/60 bg-white py-14 sm:py-16"
  >
    <div class="mx-auto max-w-6xl px-4 sm:px-6">
      <h2 class="section-title mb-3">
        <span class="block text-sm font-medium text-[#6B7280] sm:text-base"
          >í›„ì§€í•„ë¦„ ì¹´ë©”ë¼ í´ë˜ìŠ¤ ëˆ„ì  ìˆ˜ê°•ìƒ 1ìœ„</span
        >
        <span class="mt-1 block text-2xl font-bold text-[#111827] sm:text-3xl"
          >ğŸ“º ì˜¬ë¼í¬í†  ì¹´ë©”ë¼ ë§¤ë‰´ì–¼ í´ë˜ìŠ¤</span
        >
      </h2>
      <div
        id="youtube-long-grid"
        class="scroll-row flex w-full min-w-0 gap-8 pb-2 pl-4 sm:pl-6 pr-4 sm:pr-6"
      >
        <div
          class="animate-pulse shrink-0 w-[280px] sm:w-[340px] rounded-lg overflow-hidden bg-gray-200 aspect-video"
        >
        </div>
        <div
          class="animate-pulse shrink-0 w-[280px] sm:w-[340px] rounded-lg overflow-hidden bg-gray-200 aspect-video"
        >
        </div>
        <div
          class="animate-pulse shrink-0 w-[280px] sm:w-[340px] rounded-lg overflow-hidden bg-gray-200 aspect-video"
        >
        </div>
      </div>
    </div>
  </section>

  <!-- 5. ê³ í’ˆê²©! ì˜¬ë¼í¬í†  ì¹´ë©”ë¼/ë Œì¦ˆ ë¦¬ë·° (ë¸”ë¡œê·¸) -->
  <section
    id="blog"
    class="section-spacing border-t border-slate-200/60 bg-white py-14 sm:py-16"
  >
    <div class="mx-auto max-w-6xl px-4 sm:px-6">
      <h2
        class="section-title mb-3 text-2xl font-bold text-[#111827] sm:text-3xl"
      >
        âœ ê³ í’ˆê²©! ì˜¬ë¼í¬í†  ì¹´ë©”ë¼/ë Œì¦ˆ ë¦¬ë·°
      </h2>
      <div
        id="blog-grid"
        class="scroll-row flex w-full min-w-0 gap-8 pb-2 pl-4 sm:pl-6 pr-4 sm:pr-6"
      >
        <div
          class="animate-pulse shrink-0 w-[209px] rounded-lg overflow-hidden bg-gray-200 aspect-[209/314]"
        >
        </div>
        <div
          class="animate-pulse shrink-0 w-[209px] rounded-lg overflow-hidden bg-gray-200 aspect-[209/314]"
        >
        </div>
        <div
          class="animate-pulse shrink-0 w-[209px] rounded-lg overflow-hidden bg-gray-200 aspect-[209/314]"
        >
        </div>
      </div>
    </div>
  </section>

  <!-- 6. ë¹ ë¥´ê²Œ ë³´ëŠ” ì¥ë¹„ íŒ (Shorts) -->
  <section
    id="youtube-shorts"
    class="section-spacing border-t border-slate-200/60 bg-white py-14 sm:py-16"
  >
    <div class="mx-auto max-w-6xl px-4 sm:px-6">
      <h2
        class="section-title mb-3 text-2xl font-bold text-[#111827] sm:text-3xl"
      >
        ğŸ¬ ë¹ ë¥´ê²Œ ë³´ëŠ” ì¥ë¹„ íŒ
      </h2>
      <div
        id="youtube-shorts-grid"
        class="scroll-row flex w-full min-w-0 gap-8 pb-2 pl-4 sm:pl-6 pr-4 sm:pr-6"
      >
        <div
          class="animate-pulse shrink-0 w-[209px] rounded-lg overflow-hidden bg-gray-200 aspect-[209/314]"
        >
        </div>
        <div
          class="animate-pulse shrink-0 w-[209px] rounded-lg overflow-hidden bg-gray-200 aspect-[209/314]"
        >
        </div>
        <div
          class="animate-pulse shrink-0 w-[209px] rounded-lg overflow-hidden bg-gray-200 aspect-[209/314]"
        >
        </div>
      </div>
    </div>
  </section>

  <!-- 7. ì„±ê³¼ ì§€í‘œ (Performance Section) -->
  <section
    class="section-spacing border-t border-slate-200/60 bg-[#F8FAFC] py-14 sm:py-16"
  >
    <div class="mx-auto max-w-6xl px-4 sm:px-6">
      <p
        class="section-title mb-8 text-center text-sm font-semibold uppercase tracking-wider text-[#6B7280]"
      >
        ëˆ„ì  ì„±ê³¼
      </p>
      <div class="grid gap-8 sm:grid-cols-3">
        <div class="text-center">
          <p
            id="stats-youtube-subscribers"
            class="count-up text-5xl font-bold text-[#E11D48] sm:text-6xl"
          >
            0
          </p>
          <p class="mt-2 text-[#6B7280]">ìœ íŠœë¸Œ êµ¬ë…ì</p>
        </div>
        <div class="text-center">
          <p
            id="stats-youtube-views"
            class="count-up text-5xl font-bold text-[#E11D48] sm:text-6xl"
          >
            0
          </p>
          <p class="mt-2 text-[#6B7280]">ì›”ê°„ ì¡°íšŒìˆ˜</p>
        </div>
        <div class="text-center">
          <p
            id="stats-naver-visitors"
            class="count-up text-5xl font-bold text-[#E11D48] sm:text-6xl"
          >
            0
          </p>
          <p class="mt-2 text-[#6B7280]">ëˆ„ì  ë°©ë¬¸ì</p>
        </div>
      </div>
    </div>
  </section>

  <!-- 8. í˜‘ì—… / ê´‘ê³  ë¬¸ì˜ -->
  <section
    id="about"
    class="section-spacing border-t border-slate-200/60 !mt-0 bg-white py-14 sm:py-16"
  >
    <div class="mx-auto max-w-3xl px-4 text-center sm:px-6">
      <h2
        class="section-title mb-3 text-2xl font-bold text-[#111827] sm:text-3xl"
      >
        í˜‘ì—… ë° ê´‘ê³  ë¬¸ì˜
      </h2>
      <p class="mb-12 text-[#6B7280]">ë¸Œëœë“œ í˜‘ì—…Â·ê´‘ê³  ë¬¸ì˜ë¥¼ í™˜ì˜í•©ë‹ˆë‹¤</p>
      <div
        class="flex flex-col items-stretch gap-4 sm:flex-row sm:justify-center sm:gap-6"
      >
        <a
          href="https://youtube.com/channel/UCsD5VP6TvRMt-sq0q25HlIA"
          target="_blank"
          rel="noopener noreferrer"
          class="group flex flex-1 flex-col items-center gap-2 rounded-xl border border-slate-200 bg-slate-50/50 px-6 py-5 transition-all hover:border-[#E11D48] hover:bg-[#E11D48]/5 sm:max-w-[280px]"
          aria-label="ìœ íŠœë¸Œ"
        >
          <img
            src="/icons/youtube.svg"
            alt=""
            class="h-6 w-6 shrink-0"
            aria-hidden="true"
          />
          <span
            class="text-sm font-semibold text-[#111827] group-hover:text-[#E11D48]"
            >ìœ íŠœë¸Œ</span
          >
        </a>
        <a
          href="https://blog.naver.com/holaphotograph"
          target="_blank"
          rel="noopener noreferrer"
          class="group flex flex-1 flex-col items-center gap-2 rounded-xl border border-slate-200 bg-slate-50/50 px-6 py-5 transition-all hover:border-[#E11D48] hover:bg-[#E11D48]/5 sm:max-w-[280px]"
          aria-label="ë„¤ì´ë²„ ë¸”ë¡œê·¸"
        >
          <span class="relative inline-flex h-6 w-6 shrink-0">
            <img
              src="/icons/naver-blog.svg"
              alt=""
              class="h-6 w-6 block transition-opacity duration-250 group-hover:opacity-0"
              aria-hidden="true"
            />
            <img
              src="/icons/naver-blog-hover.svg"
              alt=""
              class="absolute inset-0 m-auto h-6 w-6 opacity-0 transition-opacity duration-250 group-hover:opacity-100"
              aria-hidden="true"
            />
          </span>
          <span
            class="text-sm font-semibold text-[#111827] group-hover:text-[#E11D48]"
            >ë„¤ì´ë²„ ë¸”ë¡œê·¸</span
          >
        </a>
        <a
          href="https://www.instagram.com/snap.hola"
          target="_blank"
          rel="noopener noreferrer"
          class="group flex flex-1 flex-col items-center gap-2 rounded-xl border border-slate-200 bg-slate-50/50 px-6 py-5 transition-all hover:border-[#E11D48] hover:bg-[#E11D48]/5 sm:max-w-[280px]"
          aria-label="ì¸ìŠ¤íƒ€ê·¸ë¨"
        >
          <img
            src="/icons/instagram.svg"
            alt=""
            class="h-6 w-6 shrink-0"
            aria-hidden="true"
          />
          <span
            class="text-sm font-semibold text-[#111827] group-hover:text-[#E11D48]"
            >ì¸ìŠ¤íƒ€ê·¸ë¨</span
          >
        </a>
        <a
          href="mailto:holaphotographer@gmail.com"
          class="group flex flex-1 flex-col items-center gap-2 rounded-xl border border-slate-200 bg-slate-50/50 px-6 py-5 transition-all hover:border-[#E11D48] hover:bg-[#E11D48]/5 sm:max-w-[280px]"
        >
          <img
            src="/icons/contact.svg"
            alt=""
            class="h-6 w-6 shrink-0 opacity-70"
            aria-hidden="true"
          />
          <span
            class="text-sm font-semibold text-[#111827] group-hover:text-[#E11D48]"
            >ì´ë©”ì¼</span
          >
          <span
            class="text-xs text-[#6B7280] break-all group-hover:text-[#E11D48]/90"
            >holaphotographer@gmail.com</span
          >
        </a>
      </div>
    </div>
  </section>
</Layout>

<script>
  import {
    fetchNaverRss,
    fetchYoutubeLatest,
    fetchChannelStats,
    getRssThumbnailUrl,
    type NaverRssItem,
    type YoutubeVideoItem,
  } from "../lib/api";

  // Hero Carousel
  (function initHeroCarousel() {
    const track = document.querySelector(".hero-carousel-track") as HTMLElement;
    const dots = document.querySelectorAll("[data-hero-dot]");
    const total = 3;
    let current = 0;
    let autoplayTimer: ReturnType<typeof setInterval> | null = null;
    const AUTOPLAY_MS = 5000;

    function goTo(i: number) {
      current = ((i % total) + total) % total;
      if (track) track.style.transform = `translateX(-${current * 100}%)`;
      dots.forEach((d, idx) => {
        if (idx === current) {
          d.setAttribute("aria-current", "page");
          d.classList.add("bg-[#E11D48]", "w-7");
          d.classList.remove("bg-slate-500", "w-2.5");
        } else {
          d.removeAttribute("aria-current");
          d.classList.add("bg-slate-500", "w-2.5");
          d.classList.remove("bg-[#E11D48]", "w-7");
        }
      });
    }

    function next() {
      goTo(current + 1);
    }
    function prev() {
      goTo(current - 1);
    }

    function startAutoplay() {
      stopAutoplay();
      autoplayTimer = setInterval(next, AUTOPLAY_MS);
    }
    function stopAutoplay() {
      if (autoplayTimer) clearInterval(autoplayTimer);
      autoplayTimer = null;
    }

    dots.forEach((d, i) =>
      d.addEventListener("click", () => {
        goTo(i);
        startAutoplay();
      }),
    );
    const carousel = track?.closest("#hero-carousel");
    carousel?.addEventListener("mouseenter", stopAutoplay);
    carousel?.addEventListener("mouseleave", startAutoplay);

    let touchStartX = 0;
    carousel?.addEventListener(
      "touchstart",
      (e) => {
        touchStartX = (e as TouchEvent).touches[0].clientX;
      },
      { passive: true },
    );
    carousel?.addEventListener(
      "touchend",
      (e) => {
        const te = e as TouchEvent;
        const dx = te.changedTouches[0].clientX - touchStartX;
        if (Math.abs(dx) > 50) {
          dx < 0 ? next() : prev();
          startAutoplay();
        }
      },
      { passive: true },
    );

    startAutoplay();
  })();

  const youtubeLongGrid = document.getElementById("youtube-long-grid")!;
  const youtubeShortsGrid = document.getElementById("youtube-shorts-grid")!;
  const blogGrid = document.getElementById("blog-grid")!;
  const LIMIT = 6;

  /** ì²« ë²ˆì§¸ ì„¹ì…˜(ë¡±í¼ ì˜ìƒ) ë…¸ì¶œ ìˆœì„œ (video ID) */
  const YOUTUBE_LONG_ORDER = [
    "jMMTLjQLTWg",
    "c-xvb8f9OHM",
    "qEP4MaioFPM",
    "cXfv3-85u6M",
    "p8K7iu1Rzpo",
  ];
  function getVideoId(link: string): string | null {
    if (!link || typeof link !== "string") return null;
    const trimmed = link.trim();
    if (/^[a-zA-Z0-9_-]{11}$/.test(trimmed)) return trimmed;
    const m = trimmed.match(/(?:youtu\.be\/|[/?&]v=)([a-zA-Z0-9_-]{11})/);
    return m ? m[1] : null;
  }
  function sortByPreferredOrder<T extends { link: string }>(
    items: T[],
    order: string[],
  ): T[] {
    const orderMap = new Map(order.map((id, i) => [id, i]));
    return [...items].sort((a, b) => {
      const idA = getVideoId(a.link);
      const idB = getVideoId(b.link);
      const ia = orderMap.get(idA ?? "") ?? order.length;
      const ib = orderMap.get(idB ?? "") ?? order.length;
      if (ia !== ib) return ia - ib;
      return 0;
    });
  }

  function formatCount(n: string | number): string {
    const num = typeof n === "string" ? parseInt(n, 10) : n;
    if (isNaN(num)) return "â€”";
    if (num >= 100000000)
      return (num / 100000000).toFixed(1).replace(/\.0$/, "") + "ì–µ";
    if (num >= 10000)
      return (num / 10000).toFixed(1).replace(/\.0$/, "") + "ë§Œ";
    return num.toLocaleString();
  }

  function escapeHtml(s: string) {
    const div = document.createElement("div");
    div.textContent = s;
    return div.innerHTML;
  }

  function stripHtml(html: string): string {
    const div = document.createElement("div");
    div.innerHTML = html;
    return (div.textContent || div.innerText || "").trim();
  }

  function animateCount(el: HTMLElement, target: number, duration = 1500) {
    const start = 0;
    const startTime = performance.now();
    function update(currentTime: number) {
      const elapsed = currentTime - startTime;
      const progress = Math.min(elapsed / duration, 1);
      const t = 1 - Math.pow(1 - progress, 3);
      const current = Math.floor(start + (target - start) * t);
      el.textContent = formatCount(current);
      if (progress < 1) requestAnimationFrame(update);
    }
    requestAnimationFrame(update);
  }

  function renderRssCard(
    item: NaverRssItem,
    options?: { priority?: "high" | "low" },
  ) {
    const imgUrl = getRssThumbnailUrl(item);
    const fetchPriority =
      options?.priority === "high" ? ' fetchpriority="high"' : "";
    const thumb = imgUrl
      ? `<div class="aspect-[209/314] w-full overflow-hidden bg-gray-200"><img src="${escapeHtml(imgUrl)}" alt="${escapeHtml(item.title)}" class="h-full w-full object-cover object-center opacity-0 transition-opacity duration-300" loading="lazy"${fetchPriority} decoding="async" onload="this.classList.add('opacity-100')" /></div>`
      : '<div class="aspect-[209/314] w-full bg-gray-200" />';
    const desc =
      stripHtml(item.description).slice(0, 80) +
      (stripHtml(item.description).length > 80 ? "..." : "");
    const youtubeChannelUrl = "https://www.youtube.com/@holaphotograph";
    return `
      <div class="blog-card scroll-row-item shrink-0 w-[209px] rounded-lg overflow-hidden bg-white shadow-md transition-all duration-300 hover:-translate-y-1 hover:scale-[1.02] hover:shadow-xl active:scale-[0.98]">
        <a href="${escapeHtml(item.link)}" target="_blank" rel="noopener" class="block">
          ${thumb}
          <div class="p-4 bg-white">
            <h3 class="font-semibold line-clamp-2 leading-relaxed text-sm text-[#111827]">${escapeHtml(item.title)}</h3>
            <p class="mt-1 line-clamp-2 text-xs text-[#6B7280]">${escapeHtml(desc)}</p>
          </div>
        </a>
        <div class="flex items-center justify-between gap-2 px-4 pb-4 pt-0">
          <a href="${escapeHtml(item.link)}" target="_blank" rel="noopener" class="text-xs text-[#E11D48] font-medium hover:underline">ë¸”ë¡œê·¸ ë³´ê¸° â†’</a>
          <a href="${escapeHtml(youtubeChannelUrl)}" target="_blank" rel="noopener" class="text-xs text-[#E11D48] font-medium hover:underline">ìœ íŠœë¸Œ ë³´ê¸° â†’</a>
        </div>
      </div>
    `;
  }

  function renderYoutubeCard(
    v: YoutubeVideoItem,
    options?: { priority?: "high" | "low"; label?: string; isShort?: boolean },
  ) {
    const fetchPriority =
      options?.priority === "high" ? ' fetchpriority="high"' : "";
    const label = options?.label ?? "ìœ íŠœë¸Œ ë³´ê¸° â†’";
    const cardWidth = options?.isShort ? "w-[209px]" : "w-[280px] sm:w-[340px]";
    const viewStr = v.viewCount ? formatCount(v.viewCount) + " íšŒ" : "";
    const heartSvg = `<svg class="w-3.5 h-3.5 shrink-0 inline-block" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/></svg>`;
    const commentSvg = `<svg class="w-3.5 h-3.5 shrink-0 inline-block" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/></svg>`;
    const likePart = v.likeCount ? `<span class="inline-flex items-center gap-0.5">${heartSvg}<span>${escapeHtml(formatCount(v.likeCount))}</span></span>` : "";
    const commentPart = v.commentCount ? `<span class="inline-flex items-center gap-0.5">${commentSvg}<span>${escapeHtml(formatCount(v.commentCount))}</span></span>` : "";
    const rightParts = [likePart, commentPart].filter(Boolean);
    const rightHtml = rightParts.join('<span class="text-gray-400 mx-0.5">Â·</span>');
    const leftHtml = viewStr ? escapeHtml(viewStr) : "";
    const hasMeta = leftHtml || rightHtml;
    let thumb: string;
    if (options?.isShort) {
      const aspect = "aspect-[209/314]";
      thumb = v.thumbnail_url
        ? `<div class="${aspect} w-full overflow-hidden bg-gray-200"><img src="${escapeHtml(v.thumbnail_url)}" alt="${escapeHtml(v.title)}" class="h-full w-full object-cover object-center opacity-0 transition-all duration-300 group-hover:scale-105" loading="lazy"${fetchPriority} decoding="async" onload="this.classList.add('opacity-100')" /></div>`
        : `<div class="${aspect} w-full bg-gray-200" />`;
    } else {
      const aspect = "aspect-video";
      thumb = v.thumbnail_url
        ? `<div class="${aspect} w-full overflow-hidden bg-gray-200"><img src="${escapeHtml(v.thumbnail_url)}" alt="${escapeHtml(v.title)}" class="h-full w-full object-cover opacity-0 transition-all duration-300 group-hover:scale-105" loading="lazy"${fetchPriority} decoding="async" onload="this.classList.add('opacity-100')" /></div>`
        : `<div class="${aspect} bg-gray-200" />`;
    }
    return `
      <a href="${escapeHtml(v.link)}" target="_blank" rel="noopener" class="yt-card group scroll-row-item shrink-0 ${cardWidth} rounded-lg overflow-hidden bg-white shadow-md transition-all duration-300 hover:-translate-y-1 hover:scale-[1.02] hover:shadow-xl active:scale-[0.98]">
        ${thumb}
        ${hasMeta ? `<div class="px-4 py-2 bg-gray-50 border-b border-gray-100 flex items-center justify-between gap-2 text-xs text-[#6B7280]"><span>${leftHtml}</span><span class="flex items-center shrink-0">${rightHtml}</span></div>` : ""}
        <div class="p-4 bg-white">
          <h3 class="font-semibold line-clamp-2 leading-relaxed text-sm sm:text-base text-[#111827]">${escapeHtml(v.title)}</h3>
          <p class="mt-1 text-xs text-[#E11D48] font-medium">${escapeHtml(label)}</p>
        </div>
      </a>
    `;
  }

  function renderRssSection(
    grid: HTMLElement,
    items: NaverRssItem[],
    emptyMsg: string,
    priority: "high" | "low" = "low",
  ) {
    if (items.length === 0) {
      grid.innerHTML = `<p class="shrink-0 px-4 sm:px-6 text-[#6B7280]">${emptyMsg}</p>`;
    } else {
      const toShow = items.slice(0, LIMIT);
      grid.innerHTML = toShow
        .map((item, i) =>
          renderRssCard(item, {
            priority: priority === "high" && i < 3 ? "high" : "low",
          }),
        )
        .join("");
    }
  }

  function renderYoutubeSection(
    grid: HTMLElement,
    items: YoutubeVideoItem[],
    emptyMsg: string,
    label: string,
    isShort = false,
  ) {
    if (items.length === 0) {
      grid.innerHTML = `<p class="shrink-0 px-4 sm:px-6 text-[#6B7280]">${emptyMsg}</p>`;
    } else {
      const toShow = items.slice(0, LIMIT);
      grid.innerHTML = toShow
        .map((v, i) =>
          renderYoutubeCard(v, {
            priority: i < 3 ? "high" : "low",
            label,
            isShort,
          }),
        )
        .join("");
    }
  }

  async function load() {
    try {
      const [rssRes, youtubeRes, statsRes] = await Promise.all([
        fetchNaverRss().catch(() => ({ reviews: [], guides: [], models: [], compare: [] })),
        fetchYoutubeLatest().catch(() => ({ videos: [], shorts: [], error: "Failed to load" })),
        fetchChannelStats().catch(() => null),
      ]);

      if (statsRes) {
        const subEl = document.getElementById("stats-youtube-subscribers");
        const viewsEl = document.getElementById("stats-youtube-views");
        const naverEl = document.getElementById("stats-naver-visitors");

        const subs = parseInt(statsRes.youtubeSubscribers ?? "0", 10);
        const views = parseInt(statsRes.youtubeViewCount ?? "0", 10);
        const naver = parseInt(statsRes.naverBlogVisitors ?? "0", 10);

        if (subEl && !isNaN(subs)) animateCount(subEl, subs);
        if (viewsEl && !isNaN(views)) viewsEl.textContent = formatCount(views);
        if (naverEl && !isNaN(naver)) animateCount(naverEl, naver);
      }

      const videos = youtubeRes.videos || [];
      const videosSorted = sortByPreferredOrder(videos, YOUTUBE_LONG_ORDER);
      const shorts = youtubeRes.shorts || [];
      const youtubeError = youtubeRes.error;

      renderYoutubeSection(
        youtubeLongGrid,
        videosSorted,
        youtubeError
          ? "ìœ íŠœë¸Œ API í‚¤ë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”."
          : "ë“±ë¡ëœ ë¡±í¼ ì˜ìƒì´ ì—†ìŠµë‹ˆë‹¤.",
        "ìœ íŠœë¸Œ ë³´ê¸° â†’",
      );
      setTimeout(() => {
        renderYoutubeSection(
          youtubeShortsGrid,
          shorts,
          youtubeError
            ? "ìœ íŠœë¸Œ API í‚¤ë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”."
            : "ë“±ë¡ëœ Shortsê°€ ì—†ìŠµë‹ˆë‹¤.",
          "Shorts ë³´ê¸° â†’",
          true,
        );
      }, 80);

      const compareBlog = (rssRes.compare || [])
        .filter((item) => !item.title.includes("ë³´ê¸ˆìë¦¬ë¡ "))
        .sort(
          (a, b) =>
            new Date(b.pubDate).getTime() - new Date(a.pubDate).getTime(),
        )
        .slice(0, 6);
      setTimeout(() => {
        renderRssSection(
          blogGrid,
          compareBlog,
          "ì¥ë¹„ ë¹„êµÂ·ìƒì„¸ ë¶„ì„ ì½˜í…ì¸ ê°€ ì—†ìŠµë‹ˆë‹¤.",
          "high",
        );
      }, 160);
    } catch (e) {
      youtubeLongGrid.innerHTML = `<p class="shrink-0 px-4 sm:px-6 text-[#E11D48]">ì˜ìƒì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</p>`;
      youtubeShortsGrid.innerHTML =
        '<p class="shrink-0 px-4 sm:px-6 text-[#E11D48]">Shortsë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</p>';
      blogGrid.innerHTML =
        '<p class="shrink-0 px-4 sm:px-6 text-[#E11D48]">ë¸”ë¡œê·¸ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</p>';
    }
  }

  load();
</script>
